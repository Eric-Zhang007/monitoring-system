6个月“加密中频”顶尖化计划（液态交易优先）
摘要
当前系统不是“行业顶尖”的核心原因，不只在功能缺口，而在竞争力闭环缺失：

main.py 仍混用旧表（predictions/news）与 V2 结构，导致线上口径不一致。
数据不是严格 point-in-time，可复现实验与线上回放链路不完整。
回测、信号、执行、风控没有形成同一套可审计 PnL 闭环。
缺少可量化 SLO（延迟/失败率/漂移/容量）与自动触发治理。
模型虽可跑，但缺少“可上线研究系统”必备的验证与治理框架。
目标是在 6 个月内达到“机构试运行”标准：可审计、可复现、可灰度、可回滚、可持续产出净 alpha。

目标状态（Definition of Done）
资产域：加密单域。
频率：中频（5m/15m/1h/4h）。
交易：接入 1 个真实交易所（默认 Coinbase Advanced Trade），paper 与 live 同代码路径。
研究：严格 walk-forward + purged split + 交易成本建模。
生产：模型 gate/rollback 自动化，漂移告警与执行熔断联动。
观测：Prometheus+Grafana 完整指标链路，关键告警 5 分钟内可触达。
实施方案（决策已锁定）

1. 统一数据与口径（第1-4周）
冻结旧口径 API，只保留 V2 读写路径。
建立加密专用数据表：market_bars、orderbook_l2、trades_ticks、funding_rates、onchain_signals。
所有特征与标签写入 feature_snapshots 增强版，新增 as_of_ts、event_time、data_version、lineage_id。
修复 repo 性能与一致性：连接池、批量写入、幂等 upsert、消费组初始化前置。
引入数据质量门：缺失率、延迟、跳点、重复率，低于阈值即阻断训练与上线。

2. 构建可上线研究体系（第5-8周）
标签定义：fwd_ret_1h、fwd_ret_4h（净交易成本后）。
特征定义：多窗口收益/波动、成交量冲击、盘口不平衡、资金费率、链上净流入、事件衰减特征。
模型方案：TSMixer(时序主干) + LightGBM(横截面融合) 双模型集成。
训练规范：固定随机种子、配置固化、early stopping、lr scheduler、checkpoint resume、OOM/NaN 自动降级重试。
验证规范：purged K-fold + walk-forward，输出 IC、HitRate、PnL after cost、Turnover、MaxDD。

3. 打通执行与风控闭环（第9-12周）
执行适配器：paper 与 coinbase_live 统一接口。
执行模型：限价优先+超时转市价、滑点与费用实时估算、部分成交处理、撤单重试。
风控扩展：单标的、总敞口、日内损失、连续亏损、异常波动熔断、策略级 kill switch。
归因框架：收益拆分为选币、时机、执行、成本、风险约束损耗。
交易审计：订单生命周期全链路（signal->order->fill->position->pnl）。

4. 自动化上线治理（第13-16周）
模型 gate 自动任务（每周）：不达阈值禁止晋升。
线上漂移检测（每日+实时）：PSI/KS、特征分布漂移、标签稳定性、执行偏差漂移。
自动 rollback 触发器：连续 N 个窗口低于阈值即回退上一模型。
灰度发布：10% 资金影子组合 -> 30% -> 100%，每阶段有硬门限。
Data-quality 人工闭环：自动抽样任务 + 审核 dashboard + 审核一致性统计。

5. 监控与可靠性工程（第17-20周）
指标体系：latency p50/p95/p99、error rate、data freshness、model drift、execution reject rate、PnL attribution。
告警分级：P1（交易/风控）5分钟，P2（模型/数据）15分钟。
WebSocket 背压与批量广播，慢连接隔离。
异步任务解耦：回测、训练、归因任务下沉独立 worker 队列。
混沌演练：交易所 API 抖动、Redis 中断、DB 慢查询、模型服务降级。


公共 API / 接口 / 类型变更
新增 POST /api/v2/execution/orders：提交执行任务，支持 adapter=paper|coinbase_live。
新增 GET /api/v2/execution/orders/{order_id}：订单状态与成交明细。
新增 POST /api/v2/models/drift/evaluate：返回漂移指标与建议动作。
新增 POST /api/v2/models/gate/auto-evaluate：自动门控评估与晋升/拒绝。
新增 GET /api/v2/metrics/pnl-attribution：按策略/标的/时段收益归因。
扩展 SignalGenerateRequest：加入 strategy_id、cost_profile、risk_profile。
扩展 ExecuteOrdersRequest：加入 time_in_force、max_slippage_bps、venue。
扩展 RiskCheckResponse：加入 hard_block、kill_switch_state、risk_budget_used。

测试用例与验收场景
数据一致性：同一 lineage_id 训练与推理特征一致，误差 < 1e-6。
回测真实性：加入手续费/滑点后，策略净值与 paper 实盘偏差 < 10%。
执行可靠性：交易所超时、部分成交、拒单、重试路径全覆盖。
风控有效性：触发日内损失阈值后 1 分钟内停止新开仓。
漂移治理：人为注入分布漂移后，告警与 rollback 在单次调度内触发。
性能 SLO：信号生成 p95 < 150ms，执行下单链路 p95 < 300ms。
回归覆盖：backend/tests 扩展到数据层、风控层、执行层、模型治理层核心路径。

量化门槛（顶尖化硬指标）
研究门槛：滚动 6 个月 OOS Sharpe > 1.5，MaxDD < 12%。
交易门槛：成交拒绝率 < 1%，执行偏差（实现价-预估价）均值 < 4 bps。
稳定性门槛：关键 API 可用性 > 99.9%，P1 告警漏报率 < 1%。
治理门槛：所有上线模型可复现（代码/数据/参数/特征版本一键回放）。

假设与默认
默认仅做加密单域，不在 6 个月内扩展美股。
默认中频策略，不做秒级高频。
默认保留现有技术栈（FastAPI + Postgres + Redis），不引入 Kafka 作为首期必选。
默认交易所优先 Coinbase Advanced Trade，其他交易所作为后续扩展。
默认 VC 轨道仅维护可用，不作为本阶段核心资源投入。